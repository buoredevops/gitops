node {
   def app
   environment {
   DOCKERHUB_CREDENTIALS = credentials('dockerhub')
   }

    stage ('Clone repository') 
    {
        checkout scm
    }

    stage ('Image build') {
       sh 'docker images'
       sh 'docker rmi c38bbccb0b29'
       sh 'docker build -t buore/demoapp   -f demoapp/Dockerfile  .'
       sh 'docker tag buore/demoapp:latest   buore/demoapp:${BUILD_NUMBER}'
       sh 'docker images'
    }

    stage ('Image test') {
        sh 'echo "Tests passed"'
    }

    stage('Login') {
      steps {
        sh 'echo $DOCKERHUB_CREDENTIALS_PSW | docker login -u $DOCKERHUB_CREDENTIALS_USR --password-stdin'
      }
    }
    // stage('Push') {
    //   steps {
    //     sh 'docker push buore/demoapp:${BUILD_NUMBER}'
    //   }
    // }

    // stage('Update manifest') {
    //     sh "cat demoapp-deployment.yaml"
    //     echo "Updating manifest"
    //     build job: 'updatemanifest', parameters: [string(name: 'DOCKERTAG', value: env.BUILD_NUMBER)]
    // }

}
